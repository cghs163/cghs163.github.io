<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced File Upload</title>
    <link rel="stylesheet" href="dropzone/dropzone.min.css">
    <style>
        #dropzonebox {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="dropzonebox">
        <div id="myDropzone" class="dropzone"></div>
    </div>

    <script src="dropzone/dropzone.min.js"></script>
    <script>
        Dropzone.autoDiscover = false; // 需要手动初始化Dropzone实例
        var myDropzone = new Dropzone("#myDropzone", {
            url: "http://47.98.160.127:8080",
            maxFiles: 20, //个数
            maxFilesize: 1024, //最大文件大小 MB
            acceptedFiles: ".jpg,.jpeg,.doc,.docx,.ppt,.pptx,.txt,.avi,.pdf,.mp3,.zip,.exe,.jar,.xlsx,.xls,.dbf,.db",
            autoProcessQueue: true,
            paramName: "file",
            dictDefaultMessage: "拖入需要上传的文件",
            addRemoveLinks: true, // 显示移除链接
            dictRemoveFile: "移除文件",
            init: function () {
                var self = this;

                // 监听文件添加事件
                self.on("addedfile", function (file) {
                    console.log("文件已添加:", file);
                });

                // 监听文件上传成功事件
                self.on("success", function (file, response) {
                    console.log("文件上传成功:", file, response);
                });

                // 监听文件上传失败事件
                self.on("error", function (file, errorMessage) {
                    console.log("文件上传失败:", file, errorMessage);
                });

                // 监听文件移除事件
                self.on("removedfile", function (file) {
                    console.log("文件已移除:", file);
                    let type = file.type.split('/')[0];
                    deleteFileFromServer(type,file.name);
                });

                // 监听上传队列完成事件
                self.on("queuecomplete", function () {
                    console.log("上传队列已完成");
                });
            }

        });

        let vssr = "text/plain";


        // 发起删除请求的函数
        function deleteFileFromServer(filetype, fileName) {
            // 发起删除请求的代码，可以使用 Ajax 或其他方式来向服务器发送删除请求
            // 例如使用 fetch 或 jQuery.ajax
            fetch(`http://47.98.160.127:8080/${filetype}/${fileName}`, {
                method: "DELETE"
            }).then(response => response.json())
                .then(data => {
                    console.log("文件删除成功:", data);
                })
                .catch(error => {
                    console.error("文件删除失败:", error);
                });
        }


    </script>
</body>

</html>
